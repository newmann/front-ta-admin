<page-header [title]="'部门维护'" *ngIf="processType.length > 0 "></page-header>
<nz-card [nzBordered]="false">
    <nz-tabset>
        <nz-tab>
            <ng-template #nzTabHeading>基本信息
            </ng-template>
            <span>
                <form nz-form [formGroup]="form" role="form">
                    <nz-form-item nz-row>
                        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="parent" >上级部门</nz-form-label>

                        <nz-form-control [nzSm]="6" [nzXs]="24" nzHasFeedback [nzValidateStatus]="parent">
                                <!--(nzSearchChange)="searchDepartment($event)"-->
                            <nz-select
                                nzAllowClear
                                [formControlName] = "'parent'"
                                [nzPlaceHolder]="'输入代码或名称'"
                                (nzSearchChange)="searchDepartment($event)"
                                [nzNotFoundContent]="'无法找到'"
                                nzShowSearch
                                >
                              <ng-container *ngFor="let option of searchedDepartments">
                                <nz-option *ngIf="!isLoading"
                                  [nzLabel]="option.name +'(' + option.code +')'"
                                  [nzValue]="option.id">
                                  </nz-option>
                              </ng-container>
                              <nz-option *ngIf="isLoading" nzDisabled nzCustomContent>
                                <i class="anticon anticon-loading anticon-spin loading-icon"></i> 查询中...
                              </nz-option>
                              <!--<nz-option-->
                                  <!--*ngFor="let option of searchedDepartments"-->
                                  <!--[nzLabel]="option.name +'(' + option.code +')'"-->
                                  <!--[nzValue]="option.id">-->
                              <!--</nz-option>-->
                            </nz-select>
                        </nz-form-control>
                    </nz-form-item>


                    <nz-form-item nz-row>
                        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="code" >代码</nz-form-label>

                        <nz-form-control [nzSm]="6" [nzXs]="24" nzHasFeedback [nzValidateStatus]="code">
                            <input nz-input formControlName="code" nzPlaceHolder="最少为1个字符" nzId="'code'">

                            <nz-form-explain *ngIf="code.dirty && code.errors">
                              <ng-container *ngIf="code.hasError('required')">必须输入组织代码</ng-container>
                              <ng-container *ngIf="code.hasError('duplicate')">输入的组织代码已经被使用</ng-container>
                              <ng-container *ngIf="code.hasError('other')">验证出现异常：{{code.hasError('other')}}</ng-container>
                              <ng-container *ngIf="code.hasError('minlength')">最少为一个字符</ng-container>
                              <ng-container *ngIf="code.pending">验证中...</ng-container>
                            </nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>
                    <nz-form-item nz-row>
                        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="name" >名称</nz-form-label>

                        <nz-form-control [nzSm]="6" [nzXs]="24" nzHasFeedback [nzValidateStatus]="name">
                            <input nz-input formControlName="name" nzPlaceHolder="最少为2个字符" nzId="'name'">

                            <nz-form-explain *ngIf="name.dirty && name.errors">
                              <ng-container *ngIf="name.hasError('required')">必须输入名称</ng-container>
                              <ng-container *ngIf="name.hasError('other')">验证出现异常：{{name.hasError('other')}}</ng-container>
                              <ng-container *ngIf="name.hasError('minlength')">最少为两个字符</ng-container>
                              <ng-container *ngIf="name.pending">验证中...</ng-container>
                            </nz-form-explain>
                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item>
                        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired nzFor="remarks" >备注</nz-form-label>
                        <nz-form-control nzHasFeedback>
                          <input nz-input formControlName="remarks" nzSize="large" placeholder="备注" id="remarks" >

                        </nz-form-control>
                    </nz-form-item>

                    <nz-form-item nz-row>
                       <ng-container *ngIf="errMsg && errMsg.length > 0">
                            <nz-alert [nzType]="'error'" nzCloseable [nzMessage]="'保存数据错误'"
                                      [nzDescription]="errMsg"
                            ></nz-alert>
                        </ng-container>
                    </nz-form-item>

                    <nz-form-item nz-row class="mb0">

                        <nz-form-control [nzSpan]="14" [nzOffset]="6">
                            <button nz-button [nzType]="'primary'" [nzSize]="'large'"
                                    [disabled]="form.invalid || (!form.dirty)" (click)="submitForm()">保存</button>

                            <button nz-button (click)="resetButtonClick($event)">重置</button>

                        </nz-form-control>

                    </nz-form-item>


                </form>
            </span>
        </nz-tab>
        <nz-tab [nzDisabled]="!sourceId">
            <ng-template #nzTabHeading>用户
            </ng-template>
            <byl-account-item-list [masterId]="sourceId"
                                   [findAvailablePoolsService]="departmentService"
                                   [findEntityAccountService]="departmentService"
                                   [saveAccountRelationService]="departmentService">
            </byl-account-item-list>
        </nz-tab>
        <byl-entity-logger [title]="'日志'" [entityId]="sourceId"></byl-entity-logger>
        <!--<nz-tab>-->
            <!--<ng-template #nzTabHeading>日志</ng-template>-->
            <!--<span>-->
                <!--<nz-timeline>-->
                  <!--<nz-timeline-item [nzColor]="'green'">Create a services site 2015-09-01</nz-timeline-item>-->
                  <!--<nz-timeline-item [nzColor]="'green'">Solve initial network problems 2015-09-01</nz-timeline-item>-->
                  <!--<nz-timeline-item [nzColor]="'red'">Technical testing 2015-09-01</nz-timeline-item>-->
                  <!--<nz-timeline-item>Network problems being solved 2015-09-01</nz-timeline-item>-->
                <!--</nz-timeline>-->
            <!--</span>-->
        <!--</nz-tab>-->

    </nz-tabset>
    <!--<div nz-row >-->
    <!--<div  nz-col [nzSpan]="20" [nzOffset]="4">-->
    <!--<button nz-button [nzType]="'primary'" [nzSize]="'large'" (click) = "showButtonClick($event)">show</button>-->

    <!--</div>-->

    <!--</div>-->
</nz-card>
